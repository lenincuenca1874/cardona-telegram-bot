# Ejecuta el bot de las 4 estrategias de Cardona
name: Cardona Bot

on:
  # ───────── cron en UTC ─────────
  schedule:
    # 14 :05 UTC  (10 :05 NY / 07 :05 PT)
    - cron: '5 14 * * 1-5'
  # …y permite lanzarlo manualmente
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      # 1) Clona tu repo
      - uses: actions/checkout@v4

      # 2) Instala Python
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3) Instala dependencias
      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install yfinance mplfinance python-telegram-bot==20.6 pandas

      # 4) Prueba rápida: envía un «pong» para confirmar que el chat-id y el token son correctos
      - name: Quick Telegram ping (debug)
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" \
               -d chat_id=${TELEGRAM_CHAT_ID} \
               -d text="✅ Cardona Bot online (GitHub Actions)"

      # 5) Ejecuta el bot
      - name: Run Cardona bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python cardona_telegram_bot.py
